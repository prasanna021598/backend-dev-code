pipeline {
    agent{
         label 'jenkins-agent'
    }
    options {
        // Timeout counter starts AFTER agent is allocated
        timeout(time: 30, unit: 'SECONDS')
    }
     environment {
        NEXUS_URL = 'http://3.84.135.37:8081/repository/expense-backend/' // Replace with your Nexus URL
        NEXUS_CREDENTIALS_ID = 'nexus-cred' // Jenkins credentials ID for Nexus
    }
    stages {
        stage('Install dependencies') {
            steps {
                sh """
                    npm install
                    ls -ltr
                """
            }
        }
        stage('Zipping the code') {
            steps {
                sh """
                zip -r backend.zip * -x jenkinsfile 
                """
            }
        }
         stage('Upload to Nexus') {
            steps {
                script {
                    nexusArtifactUploader artifacts: [[artifactId: 'backend', 
                                                       classifier: '', 
                                                       file: 'backend.zip', 
                                                       type: 'zip']], 
                                         credentialsId: "${env.NEXUS_CREDENTIALS_ID}", 
                                         groupId: 'com.example', 
                                         nexusUrl: "${env.NEXUS_URL}", 
                                         protocol: 'http', 
                                         repository: 'expense-backend', 
                                         version: '1.0.0'
                }
            }
        }
    }
}